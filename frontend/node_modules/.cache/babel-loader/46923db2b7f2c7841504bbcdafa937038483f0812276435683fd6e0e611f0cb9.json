{"ast":null,"code":"import _objectSpread from\"/Users/macmini/Documents/Sistema_Consultorio/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// src/components/financeiro/PagamentoModal.jsx - VERSÃO FINAL\nimport React,{useState,useEffect}from'react';import{Box,Button,CircularProgress,Dialog,DialogActions,DialogContent,DialogTitle,TextField,Select,MenuItem,InputLabel,FormControl,Typography}from'@mui/material';import{faturamentoService}from'../../services/faturamentoService';// <-- ADICIONADO\nimport{useSnackbar}from'../../contexts/SnackbarContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const initialFormState={valor:'',forma_pagamento:''};// 1. A prop agora é 'pagamento'\nexport default function PagamentoModal(_ref){let{open,onClose,onSave,pagamento}=_ref;const[formData,setFormData]=useState(initialFormState);const[isSubmitting,setIsSubmitting]=useState(false);const{showSnackbar}=useSnackbar();// 2. Popula o formulário com os dados do pagamento quando o modal abre\nuseEffect(()=>{if(pagamento){setFormData({valor:pagamento.valor>0?pagamento.valor:'',// Se o valor for 0, deixa em branco para o usuário preencher\nforma_pagamento:''});}},[pagamento]);const handleClose=()=>{setFormData(initialFormState);onClose();};const handleSubmit=async e=>{e.preventDefault();setIsSubmitting(true);try{const dataToSend={valor:formData.valor,forma_pagamento:formData.forma_pagamento,status:'Pago'};// AQUI ESTÁ A MUDANÇA: Usando o serviço\nawait faturamentoService.updatePagamento(pagamento.id,dataToSend);showSnackbar('Pagamento registado com sucesso!','success');onSave();handleClose();}catch(error){var _error$response;console.error(\"Erro ao registar pagamento:\",(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data);showSnackbar('Erro ao registar pagamento.','error');}finally{setIsSubmitting(false);}};if(!pagamento)return null;return/*#__PURE__*/_jsxs(Dialog,{open:open,onClose:handleClose,fullWidth:true,maxWidth:\"xs\",children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Registar Pagamento\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsxs(Typography,{variant:\"subtitle1\",children:[\"Paciente: \",/*#__PURE__*/_jsx(\"strong\",{children:pagamento.paciente_nome})]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"text.secondary\",gutterBottom:true,children:[\"Consulta de \",pagamento.agendamento.tipo_consulta,\" em \",new Date(pagamento.agendamento.data_hora_inicio).toLocaleDateString('pt-BR')]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',flexDirection:'column',gap:2,pt:2},children:[/*#__PURE__*/_jsx(TextField,{name:\"valor\",label:\"Valor a Pagar (R$)\",type:\"number\",value:formData.valor,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{valor:e.target.value})),required:true,autoFocus:true}),/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,required:true,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"forma-pagamento-label\",children:\"Forma de Pagamento\"}),/*#__PURE__*/_jsxs(Select,{labelId:\"forma-pagamento-label\",name:\"forma_pagamento\",value:formData.forma_pagamento,label:\"Forma de Pagamento\",onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{forma_pagamento:e.target.value})),children:[/*#__PURE__*/_jsx(MenuItem,{value:\"Dinheiro\",children:\"Dinheiro\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"CartaoCredito\",children:\"Cart\\xE3o de Cr\\xE9dito\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"CartaoDebito\",children:\"Cart\\xE3o de D\\xE9bito\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"PIX\",children:\"PIX\"})]})]})]})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:handleClose,children:\"Cancelar\"}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"contained\",disabled:isSubmitting,children:isSubmitting?/*#__PURE__*/_jsx(CircularProgress,{size:24}):'Confirmar Pagamento'})]})]})]});}","map":{"version":3,"names":["React","useState","useEffect","Box","Button","CircularProgress","Dialog","DialogActions","DialogContent","DialogTitle","TextField","Select","MenuItem","InputLabel","FormControl","Typography","faturamentoService","useSnackbar","jsx","_jsx","jsxs","_jsxs","initialFormState","valor","forma_pagamento","PagamentoModal","_ref","open","onClose","onSave","pagamento","formData","setFormData","isSubmitting","setIsSubmitting","showSnackbar","handleClose","handleSubmit","e","preventDefault","dataToSend","status","updatePagamento","id","error","_error$response","console","response","data","fullWidth","maxWidth","children","onSubmit","variant","paciente_nome","color","gutterBottom","agendamento","tipo_consulta","Date","data_hora_inicio","toLocaleDateString","sx","display","flexDirection","gap","pt","name","label","type","value","onChange","_objectSpread","target","required","autoFocus","labelId","onClick","disabled","size"],"sources":["/Users/macmini/Documents/Sistema_Consultorio/frontend/src/components/financeiro/PagamentoModal.jsx"],"sourcesContent":["// src/components/financeiro/PagamentoModal.jsx - VERSÃO FINAL\n\nimport React, { useState, useEffect } from 'react';\nimport {\n    Box, Button, CircularProgress, Dialog, DialogActions, DialogContent, \n    DialogTitle, TextField, Select, MenuItem, InputLabel, FormControl, Typography\n} from '@mui/material';\nimport { faturamentoService } from '../../services/faturamentoService'; // <-- ADICIONADO\nimport { useSnackbar } from '../../contexts/SnackbarContext';\n\nconst initialFormState = { valor: '', forma_pagamento: '' };\n\n// 1. A prop agora é 'pagamento'\nexport default function PagamentoModal({ open, onClose, onSave, pagamento }) {\n    const [formData, setFormData] = useState(initialFormState);\n    const [isSubmitting, setIsSubmitting] = useState(false);\n    const { showSnackbar } = useSnackbar();\n\n    // 2. Popula o formulário com os dados do pagamento quando o modal abre\n    useEffect(() => {\n        if (pagamento) {\n            setFormData({\n                valor: pagamento.valor > 0 ? pagamento.valor : '', // Se o valor for 0, deixa em branco para o usuário preencher\n                forma_pagamento: '',\n            });\n        }\n    }, [pagamento]);\n\n    const handleClose = () => {\n        setFormData(initialFormState);\n        onClose();\n    };\n\nconst handleSubmit = async (e) => {\n        e.preventDefault();\n        setIsSubmitting(true);\n        try {\n            const dataToSend = {\n                valor: formData.valor,\n                forma_pagamento: formData.forma_pagamento,\n                status: 'Pago'\n            };\n            // AQUI ESTÁ A MUDANÇA: Usando o serviço\n            await faturamentoService.updatePagamento(pagamento.id, dataToSend);\n            \n            showSnackbar('Pagamento registado com sucesso!', 'success');\n            onSave();\n            handleClose();\n        } catch (error) {\n            console.error(\"Erro ao registar pagamento:\", error.response?.data);\n            showSnackbar('Erro ao registar pagamento.', 'error');\n        } finally {\n            setIsSubmitting(false);\n        }\n    };\n\n    if (!pagamento) return null;\n\n    return (\n        <Dialog open={open} onClose={handleClose} fullWidth maxWidth=\"xs\">\n            <DialogTitle>Registar Pagamento</DialogTitle>\n            <form onSubmit={handleSubmit}>\n                <DialogContent>\n                    {/* 4. As informações vêm do objeto 'pagamento' */}\n                    <Typography variant=\"subtitle1\">Paciente: <strong>{pagamento.paciente_nome}</strong></Typography>\n                    <Typography variant=\"body2\" color=\"text.secondary\" gutterBottom>\n                        Consulta de {pagamento.agendamento.tipo_consulta} em {new Date(pagamento.agendamento.data_hora_inicio).toLocaleDateString('pt-BR')}\n                    </Typography>\n                    <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2, pt: 2 }}>\n                        <TextField\n                            name=\"valor\"\n                            label=\"Valor a Pagar (R$)\"\n                            type=\"number\"\n                            value={formData.valor}\n                            onChange={(e) => setFormData({ ...formData, valor: e.target.value })}\n                            required\n                            autoFocus\n                        />\n                        <FormControl fullWidth required>\n                            <InputLabel id=\"forma-pagamento-label\">Forma de Pagamento</InputLabel>\n                            <Select\n                                labelId=\"forma-pagamento-label\"\n                                name=\"forma_pagamento\"\n                                value={formData.forma_pagamento}\n                                label=\"Forma de Pagamento\"\n                                onChange={(e) => setFormData({ ...formData, forma_pagamento: e.target.value })}\n                            >\n                                <MenuItem value=\"Dinheiro\">Dinheiro</MenuItem>\n                                <MenuItem value=\"CartaoCredito\">Cartão de Crédito</MenuItem>\n                                <MenuItem value=\"CartaoDebito\">Cartão de Débito</MenuItem>\n                                <MenuItem value=\"PIX\">PIX</MenuItem>\n                            </Select>\n                        </FormControl>\n                    </Box>\n                </DialogContent>\n                <DialogActions>\n                    <Button onClick={handleClose}>Cancelar</Button>\n                    <Button type=\"submit\" variant=\"contained\" disabled={isSubmitting}>\n                        {isSubmitting ? <CircularProgress size={24} /> : 'Confirmar Pagamento'}\n                    </Button>\n                </DialogActions>\n            </form>\n        </Dialog>\n    );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}