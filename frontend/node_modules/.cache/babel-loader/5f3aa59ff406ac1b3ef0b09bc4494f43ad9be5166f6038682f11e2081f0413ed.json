{"ast":null,"code":"// src/components/financeiro/PagamentosPendentesView.jsx - VERSÃO CORRIGIDA E ORGANIZADA\nimport React,{useState,useEffect,useCallback}from'react';import{Box,Button,CircularProgress,Typography,Paper,Table,TableBody,TableCell,TableContainer,TableHead,TableRow}from'@mui/material';import{faturamentoService}from'../../services/faturamentoService';// <-- IMPORTAMOS O SERVIÇO\nimport PagamentoModal from'./PagamentoModal';import{useSnackbar}from'../../contexts/SnackbarContext';// Para dar feedback ao usuário\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function PagamentosPendentesView(){// 1. Nomenclatura atualizada para clareza\nconst[pagamentosPendentes,setPagamentosPendentes]=useState([]);const[isLoading,setIsLoading]=useState(true);const[isModalOpen,setIsModalOpen]=useState(false);const[selectedPagamento,setSelectedPagamento]=useState(null);// Agora selecionamos um pagamento\nconst{showSnackbar}=useSnackbar();const fetchPendentes=useCallback(async()=>{if(pagamentosPendentes.length===0)setIsLoading(true);try{// A MÁGICA ACONTECE AQUI: Usamos a função do serviço\nconst response=await faturamentoService.getPagamentosPendentes();setPagamentosPendentes(response.data);}catch(error){console.error(\"Erro ao buscar pagamentos pendentes:\",error);showSnackbar(\"Erro ao carregar pagamentos pendentes.\",'error');}finally{setIsLoading(false);}},[pagamentosPendentes.length,showSnackbar]);useEffect(()=>{fetchPendentes();},[fetchPendentes]);const handleOpenModal=pagamento=>{setSelectedPagamento(pagamento);// Passa o objeto de pagamento\nsetIsModalOpen(true);};const handleCloseModal=()=>{setIsModalOpen(false);setSelectedPagamento(null);};const handleSavePagamento=()=>{handleCloseModal();fetchPendentes();// Recarrega a lista após salvar\n};if(isLoading){return/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center',mt:4},children:/*#__PURE__*/_jsx(CircularProgress,{})});}return/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(TableContainer,{component:Paper,children:/*#__PURE__*/_jsxs(Table,{children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:\"Data da Consulta\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Paciente\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Tipo da Consulta\"}),/*#__PURE__*/_jsx(TableCell,{align:\"right\",children:\"A\\xE7\\xF5es\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:pagamentosPendentes.length>0?pagamentosPendentes.map(pag=>/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:pag.agendamento?new Date(pag.agendamento.data_hora_inicio).toLocaleString('pt-BR'):'Agendamento Removido'}),/*#__PURE__*/_jsx(TableCell,{children:pag.paciente_nome}),/*#__PURE__*/_jsx(TableCell,{children:pag.agendamento?pag.agendamento.tipo_consulta:'N/A'}),/*#__PURE__*/_jsx(TableCell,{align:\"right\",children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",size:\"small\",onClick:()=>handleOpenModal(pag),children:\"Registar Pagamento\"})})]},pag.id)):/*#__PURE__*/_jsx(TableRow,{children:/*#__PURE__*/_jsx(TableCell,{colSpan:4,align:\"center\",children:\"N\\xE3o h\\xE1 pagamentos pendentes.\"})})})]})}),selectedPagamento&&/*#__PURE__*/_jsx(PagamentoModal,{open:isModalOpen,onClose:handleCloseModal,onSave:handleSavePagamento,pagamento:selectedPagamento// A prop agora é 'pagamento'\n})]});}","map":{"version":3,"names":["React","useState","useEffect","useCallback","Box","Button","CircularProgress","Typography","Paper","Table","TableBody","TableCell","TableContainer","TableHead","TableRow","faturamentoService","PagamentoModal","useSnackbar","jsx","_jsx","jsxs","_jsxs","PagamentosPendentesView","pagamentosPendentes","setPagamentosPendentes","isLoading","setIsLoading","isModalOpen","setIsModalOpen","selectedPagamento","setSelectedPagamento","showSnackbar","fetchPendentes","length","response","getPagamentosPendentes","data","error","console","handleOpenModal","pagamento","handleCloseModal","handleSavePagamento","sx","display","justifyContent","mt","children","component","align","map","pag","agendamento","Date","data_hora_inicio","toLocaleString","paciente_nome","tipo_consulta","variant","size","onClick","id","colSpan","open","onClose","onSave"],"sources":["/Users/macmini/Documents/Sistema_Consultorio/frontend/src/components/financeiro/PagamentosPendentesView.jsx"],"sourcesContent":["// src/components/financeiro/PagamentosPendentesView.jsx - VERSÃO CORRIGIDA E ORGANIZADA\nimport React, { useState, useEffect, useCallback } from 'react';\nimport {\n    Box, Button, CircularProgress, Typography, Paper,\n    Table, TableBody, TableCell, TableContainer, TableHead, TableRow\n} from '@mui/material';\n\nimport { faturamentoService } from '../../services/faturamentoService'; // <-- IMPORTAMOS O SERVIÇO\nimport PagamentoModal from './PagamentoModal'; \nimport { useSnackbar } from '../../contexts/SnackbarContext'; // Para dar feedback ao usuário\n\nexport default function PagamentosPendentesView() {\n    // 1. Nomenclatura atualizada para clareza\n    const [pagamentosPendentes, setPagamentosPendentes] = useState([]);\n    const [isLoading, setIsLoading] = useState(true);\n    const [isModalOpen, setIsModalOpen] = useState(false);\n    const [selectedPagamento, setSelectedPagamento] = useState(null); // Agora selecionamos um pagamento\n    const { showSnackbar } = useSnackbar();\n\n    const fetchPendentes = useCallback(async () => {\n        if (pagamentosPendentes.length === 0) setIsLoading(true);\n        try {\n            // A MÁGICA ACONTECE AQUI: Usamos a função do serviço\n            const response = await faturamentoService.getPagamentosPendentes();\n            setPagamentosPendentes(response.data);\n        } catch (error) {\n            console.error(\"Erro ao buscar pagamentos pendentes:\", error);\n            showSnackbar(\"Erro ao carregar pagamentos pendentes.\", 'error');\n        } finally {\n            setIsLoading(false);\n        }\n    }, [pagamentosPendentes.length, showSnackbar]);\n\n    useEffect(() => {\n        fetchPendentes();\n    }, [fetchPendentes]);\n\n    const handleOpenModal = (pagamento) => {\n        setSelectedPagamento(pagamento); // Passa o objeto de pagamento\n        setIsModalOpen(true);\n    };\n\n    const handleCloseModal = () => {\n        setIsModalOpen(false);\n        setSelectedPagamento(null);\n    }\n\n    const handleSavePagamento = () => {\n        handleCloseModal();\n        fetchPendentes(); // Recarrega a lista após salvar\n    }\n\n    if (isLoading) {\n        return <Box sx={{ display: 'flex', justifyContent: 'center', mt: 4 }}><CircularProgress /></Box>;\n    }\n\n    return (\n        <Box>\n            <TableContainer component={Paper}>\n                <Table>\n                    <TableHead>\n                        <TableRow>\n                            <TableCell>Data da Consulta</TableCell>\n                            <TableCell>Paciente</TableCell>\n                            <TableCell>Tipo da Consulta</TableCell>\n                            <TableCell align=\"right\">Ações</TableCell>\n                        </TableRow>\n                    </TableHead>\n                    <TableBody>\n                        {pagamentosPendentes.length > 0 ? (\n                            pagamentosPendentes.map((pag) => (\n                                <TableRow key={pag.id}>\n                                    {/* --- A CORREÇÃO ESTÁ AQUI --- */}\n                                    {/* Usamos 'pag.agendamento?.' para aceder com segurança. Se pag.agendamento for nulo, não quebra. */}\n                                    <TableCell>\n                                        {pag.agendamento ? new Date(pag.agendamento.data_hora_inicio).toLocaleString('pt-BR') : 'Agendamento Removido'}\n                                    </TableCell>\n                                    <TableCell>{pag.paciente_nome}</TableCell>\n                                    <TableCell>\n                                        {pag.agendamento ? pag.agendamento.tipo_consulta : 'N/A'}\n                                    </TableCell>\n                                    <TableCell align=\"right\">\n                                        <Button \n                                            variant=\"contained\" \n                                            size=\"small\"\n                                            onClick={() => handleOpenModal(pag)}\n                                        >\n                                            Registar Pagamento\n                                        </Button>\n                                    </TableCell>\n                                </TableRow>\n                            ))\n                        ) : (\n                            <TableRow>\n                                <TableCell colSpan={4} align=\"center\">\n                                    Não há pagamentos pendentes.\n                                </TableCell>\n                            </TableRow>\n                        )}\n                    </TableBody>\n                </Table>\n            </TableContainer>\n            \n            {/* 4. Passa o objeto de pagamento para o modal */}\n            {selectedPagamento && (\n                <PagamentoModal \n                    open={isModalOpen}\n                    onClose={handleCloseModal}\n                    onSave={handleSavePagamento}\n                    pagamento={selectedPagamento} // A prop agora é 'pagamento'\n                />\n            )}\n        </Box>\n    );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}