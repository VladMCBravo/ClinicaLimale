{"ast":null,"code":"// src/components/financeiro/RelatoriosView.jsx\nimport React,{useState,useEffect,useCallback}from'react';import{Box,CircularProgress,Typography,Paper,Grid}from'@mui/material';import{faturamentoService}from'../../services/faturamentoService';// <-- ADICIONADO\n// Importando os componentes de gráficos e o core do Chart.js\nimport{Chart as ChartJS,ArcElement,Tooltip,Legend,CategoryScale,LinearScale,BarElement,Title}from'chart.js';import{Pie,Bar}from'react-chartjs-2';// Registro dos componentes necessários do Chart.js\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";ChartJS.register(ArcElement,Tooltip,Legend,CategoryScale,LinearScale,BarElement,Title);export default function RelatoriosView(){const[reportData,setReportData]=useState(null);const[isLoading,setIsLoading]=useState(true);const fetchReports=useCallback(async()=>{setIsLoading(true);try{// AQUI ESTÁ A MUDANÇA: Usando o serviço\nconst response=await faturamentoService.getRelatorioFinanceiro();setReportData(response.data);}catch(error){console.error(\"Erro ao buscar relatórios:\",error);}finally{setIsLoading(false);}},[]);useEffect(()=>{fetchReports();},[fetchReports]);if(isLoading){return/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center',mt:4},children:/*#__PURE__*/_jsx(CircularProgress,{})});}if(!reportData){return/*#__PURE__*/_jsx(Typography,{children:\"N\\xE3o foi poss\\xEDvel carregar os dados do relat\\xF3rio.\"});}// --- Preparando os dados para os gráficos ---\nconst faturamentoPorFormaData={labels:reportData.faturamento_por_forma.map(item=>item.forma_pagamento),datasets:[{data:reportData.faturamento_por_forma.map(item=>item.total),backgroundColor:['#4CAF50','#2196F3','#FFC107','#FF5722','#9C27B0']}]};const despesasPorCategoriaData={labels:reportData.despesas_por_categoria.map(item=>item.categoria__nome),datasets:[{data:reportData.despesas_por_categoria.map(item=>item.total),backgroundColor:['#F44336','#E91E63','#3F51B5','#009688','#FF9800']}]};const fluxoCaixaData={labels:reportData.fluxo_caixa_mensal.map(item=>new Date(item.mes).toLocaleString('pt-BR',{month:'long',year:'numeric',timeZone:'UTC'})),datasets:[{label:'Receitas',data:reportData.fluxo_caixa_mensal.map(item=>item.receitas),backgroundColor:'rgba(75, 192, 192, 0.6)'},{label:'Despesas',data:reportData.fluxo_caixa_mensal.map(item=>item.despesas),backgroundColor:'rgba(255, 99, 132, 0.6)'}]};return/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsxs(Paper,{sx:{p:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",align:\"center\",children:\"Faturamento por Forma de Pagamento\"}),/*#__PURE__*/_jsx(Pie,{data:faturamentoPorFormaData})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsxs(Paper,{sx:{p:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",align:\"center\",children:\"Despesas por Categoria\"}),/*#__PURE__*/_jsx(Pie,{data:despesasPorCategoriaData})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsxs(Paper,{sx:{p:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",align:\"center\",children:\"Fluxo de Caixa Mensal\"}),/*#__PURE__*/_jsx(Bar,{data:fluxoCaixaData,options:{responsive:true,plugins:{title:{display:true,text:'Receitas vs. Despesas'}}}})]})})]});}","map":{"version":3,"names":["React","useState","useEffect","useCallback","Box","CircularProgress","Typography","Paper","Grid","faturamentoService","Chart","ChartJS","ArcElement","Tooltip","Legend","CategoryScale","LinearScale","BarElement","Title","Pie","Bar","jsx","_jsx","jsxs","_jsxs","register","RelatoriosView","reportData","setReportData","isLoading","setIsLoading","fetchReports","response","getRelatorioFinanceiro","data","error","console","sx","display","justifyContent","mt","children","faturamentoPorFormaData","labels","faturamento_por_forma","map","item","forma_pagamento","datasets","total","backgroundColor","despesasPorCategoriaData","despesas_por_categoria","categoria__nome","fluxoCaixaData","fluxo_caixa_mensal","Date","mes","toLocaleString","month","year","timeZone","label","receitas","despesas","container","spacing","xs","md","p","variant","align","options","responsive","plugins","title","text"],"sources":["/Users/macmini/Documents/Sistema_Consultorio/frontend/src/components/financeiro/RelatoriosView.jsx"],"sourcesContent":["// src/components/financeiro/RelatoriosView.jsx\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { Box, CircularProgress, Typography, Paper, Grid } from '@mui/material';\n\nimport { faturamentoService } from '../../services/faturamentoService'; // <-- ADICIONADO\n// Importando os componentes de gráficos e o core do Chart.js\nimport { Chart as ChartJS, ArcElement, Tooltip, Legend, CategoryScale, LinearScale, BarElement, Title } from 'chart.js';\nimport { Pie, Bar } from 'react-chartjs-2';\n\n// Registro dos componentes necessários do Chart.js\nChartJS.register(ArcElement, Tooltip, Legend, CategoryScale, LinearScale, BarElement, Title);\n\nexport default function RelatoriosView() {\n    const [reportData, setReportData] = useState(null);\n    const [isLoading, setIsLoading] = useState(true);\n\n    const fetchReports = useCallback(async () => {\n        setIsLoading(true);\n        try {\n            // AQUI ESTÁ A MUDANÇA: Usando o serviço\n            const response = await faturamentoService.getRelatorioFinanceiro();\n            setReportData(response.data);\n        } catch (error) {\n            console.error(\"Erro ao buscar relatórios:\", error);\n        } finally {\n            setIsLoading(false);\n        }\n    }, []);\n\n    useEffect(() => {\n        fetchReports();\n    }, [fetchReports]);\n\n\n    if (isLoading) {\n        return <Box sx={{ display: 'flex', justifyContent: 'center', mt: 4 }}><CircularProgress /></Box>;\n    }\n\n    if (!reportData) {\n        return <Typography>Não foi possível carregar os dados do relatório.</Typography>;\n    }\n\n    // --- Preparando os dados para os gráficos ---\n    const faturamentoPorFormaData = {\n        labels: reportData.faturamento_por_forma.map(item => item.forma_pagamento),\n        datasets: [{\n            data: reportData.faturamento_por_forma.map(item => item.total),\n            backgroundColor: ['#4CAF50', '#2196F3', '#FFC107', '#FF5722', '#9C27B0'],\n        }],\n    };\n\n    const despesasPorCategoriaData = {\n        labels: reportData.despesas_por_categoria.map(item => item.categoria__nome),\n        datasets: [{\n            data: reportData.despesas_por_categoria.map(item => item.total),\n            backgroundColor: ['#F44336', '#E91E63', '#3F51B5', '#009688', '#FF9800'],\n        }],\n    };\n    \n    const fluxoCaixaData = {\n        labels: reportData.fluxo_caixa_mensal.map(item => new Date(item.mes).toLocaleString('pt-BR', { month: 'long', year: 'numeric', timeZone: 'UTC' })),\n        datasets: [\n            {\n                label: 'Receitas',\n                data: reportData.fluxo_caixa_mensal.map(item => item.receitas),\n                backgroundColor: 'rgba(75, 192, 192, 0.6)',\n            },\n            {\n                label: 'Despesas',\n                data: reportData.fluxo_caixa_mensal.map(item => item.despesas),\n                backgroundColor: 'rgba(255, 99, 132, 0.6)',\n            }\n        ]\n    };\n\n    return (\n        <Grid container spacing={3}>\n            <Grid item xs={12} md={6}>\n                <Paper sx={{ p: 2 }}>\n                    <Typography variant=\"h6\" align=\"center\">Faturamento por Forma de Pagamento</Typography>\n                    <Pie data={faturamentoPorFormaData} />\n                </Paper>\n            </Grid>\n            <Grid item xs={12} md={6}>\n                <Paper sx={{ p: 2 }}>\n                    <Typography variant=\"h6\" align=\"center\">Despesas por Categoria</Typography>\n                    <Pie data={despesasPorCategoriaData} />\n                </Paper>\n            </Grid>\n            <Grid item xs={12}>\n                <Paper sx={{ p: 2 }}>\n                    <Typography variant=\"h6\" align=\"center\">Fluxo de Caixa Mensal</Typography>\n                    <Bar data={fluxoCaixaData} options={{ responsive: true, plugins: { title: { display: true, text: 'Receitas vs. Despesas' } } }}/>\n                </Paper>\n            </Grid>\n        </Grid>\n    );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}