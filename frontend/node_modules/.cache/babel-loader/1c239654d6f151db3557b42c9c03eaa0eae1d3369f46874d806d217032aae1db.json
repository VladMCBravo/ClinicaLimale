{"ast":null,"code":"// src/components/configuracoes/ConvenioModal.jsx\nimport React,{useState,useEffect}from'react';import{Dialog,DialogTitle,DialogContent,DialogActions,TextField,Button,CircularProgress,Box,IconButton,Typography}from'@mui/material';import AddCircleOutlineIcon from'@mui/icons-material/AddCircleOutline';import RemoveCircleOutlineIcon from'@mui/icons-material/RemoveCircleOutline';import apiClient from'../../api/axiosConfig';import{useSnackbar}from'../../contexts/SnackbarContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function ConvenioModal(_ref){let{open,onClose,onSave,convenioParaEditar}=_ref;const{showSnackbar}=useSnackbar();const[nome,setNome]=useState('');const[planos,setPlanos]=useState([{nome:'',descricao:''}]);const[isSubmitting,setIsSubmitting]=useState(false);useEffect(()=>{if(convenioParaEditar){setNome(convenioParaEditar.nome);// Se o convênio tem planos, usa a lista de planos. Senão, começa com um plano vazio.\nsetPlanos(convenioParaEditar.planos&&convenioParaEditar.planos.length>0?convenioParaEditar.planos:[{nome:'',descricao:''}]);}else{// Reseta para o estado inicial ao criar um novo\nsetNome('');setPlanos([{nome:'',descricao:''}]);}},[convenioParaEditar,open]);const handlePlanoChange=(index,event)=>{const newPlanos=[...planos];newPlanos[index][event.target.name]=event.target.value;setPlanos(newPlanos);};const handleAddPlano=()=>{setPlanos([...planos,{nome:'',descricao:''}]);};const handleRemovePlano=index=>{if(planos.length>1){setPlanos(planos.filter((_,i)=>i!==index));}};const handleSubmit=async e=>{e.preventDefault();setIsSubmitting(true);// Filtra planos que tenham um nome, para não enviar planos vazios\nconst planosValidos=planos.filter(p=>p.nome.trim()!=='');// --- A MUDANÇA ESTÁ AQUI ---\nconst convenioData={nome,planos:planosValidos// Envia a lista de planos junto\n};try{if(convenioParaEditar){await apiClient.put(\"/faturamento/convenios/\".concat(convenioParaEditar.id,\"/\"),convenioData);}else{await apiClient.post('/faturamento/convenios/',convenioData);}showSnackbar('Convênio e planos salvos com sucesso!','success');onSave();onClose();}catch(error){var _error$response,_error$response2,_error$response2$data,_error$response2$data2;console.error(\"Erro ao salvar convênio:\",(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data);const errorMessage=((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:(_error$response2$data2=_error$response2$data.nome)===null||_error$response2$data2===void 0?void 0:_error$response2$data2[0])||'Erro ao salvar convênio.';showSnackbar(errorMessage,'error');}finally{setIsSubmitting(false);}};return/*#__PURE__*/_jsxs(Dialog,{open:open,onClose:onClose,fullWidth:true,maxWidth:\"sm\",children:[/*#__PURE__*/_jsx(DialogTitle,{children:convenioParaEditar?'Editar Convênio':'Novo Convênio'}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsx(TextField,{autoFocus:true,label:\"Nome do Conv\\xEAnio\",value:nome,onChange:e=>setNome(e.target.value),fullWidth:true,required:true,sx:{mb:3}}),/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",gutterBottom:true,children:\"Planos\"}),planos.map((plano,index)=>/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',gap:1,alignItems:'center',mb:1.5},children:[/*#__PURE__*/_jsx(TextField,{name:\"nome\",label:\"Nome do Plano\",value:plano.nome,onChange:e=>handlePlanoChange(index,e),fullWidth:true,size:\"small\"}),/*#__PURE__*/_jsx(TextField,{name:\"descricao\",label:\"Descri\\xE7\\xE3o\",value:plano.descricao,onChange:e=>handlePlanoChange(index,e),fullWidth:true,size:\"small\"}),/*#__PURE__*/_jsx(IconButton,{onClick:()=>handleRemovePlano(index),color:\"error\",disabled:planos.length<=1,children:/*#__PURE__*/_jsx(RemoveCircleOutlineIcon,{})})]},index)),/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(AddCircleOutlineIcon,{}),onClick:handleAddPlano,size:\"small\",children:\"Adicionar Plano\"})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:onClose,children:\"Cancelar\"}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"contained\",disabled:isSubmitting,children:isSubmitting?/*#__PURE__*/_jsx(CircularProgress,{size:24}):'Salvar'})]})]})]});}","map":{"version":3,"names":["React","useState","useEffect","Dialog","DialogTitle","DialogContent","DialogActions","TextField","Button","CircularProgress","Box","IconButton","Typography","AddCircleOutlineIcon","RemoveCircleOutlineIcon","apiClient","useSnackbar","jsx","_jsx","jsxs","_jsxs","ConvenioModal","_ref","open","onClose","onSave","convenioParaEditar","showSnackbar","nome","setNome","planos","setPlanos","descricao","isSubmitting","setIsSubmitting","length","handlePlanoChange","index","event","newPlanos","target","name","value","handleAddPlano","handleRemovePlano","filter","_","i","handleSubmit","e","preventDefault","planosValidos","p","trim","convenioData","put","concat","id","post","error","_error$response","_error$response2","_error$response2$data","_error$response2$data2","console","response","data","errorMessage","fullWidth","maxWidth","children","onSubmit","autoFocus","label","onChange","required","sx","mb","variant","gutterBottom","map","plano","display","gap","alignItems","size","onClick","color","disabled","startIcon","type"],"sources":["/Users/macmini/Documents/Sistema_Consultorio/frontend/src/components/configuracoes/ConvenioModal.jsx"],"sourcesContent":["// src/components/configuracoes/ConvenioModal.jsx\nimport React, { useState, useEffect } from 'react';\nimport { Dialog, DialogTitle, DialogContent, DialogActions, TextField, Button, CircularProgress, Box, IconButton, Typography } from '@mui/material';\nimport AddCircleOutlineIcon from '@mui/icons-material/AddCircleOutline';\nimport RemoveCircleOutlineIcon from '@mui/icons-material/RemoveCircleOutline';\nimport apiClient from '../../api/axiosConfig';\nimport { useSnackbar } from '../../contexts/SnackbarContext';\n\nexport default function ConvenioModal({ open, onClose, onSave, convenioParaEditar }) {\n    const { showSnackbar } = useSnackbar();\n    const [nome, setNome] = useState('');\n    const [planos, setPlanos] = useState([{ nome: '', descricao: '' }]);\n    const [isSubmitting, setIsSubmitting] = useState(false);\n\n    useEffect(() => {\n        if (convenioParaEditar) {\n            setNome(convenioParaEditar.nome);\n            // Se o convênio tem planos, usa a lista de planos. Senão, começa com um plano vazio.\n            setPlanos(convenioParaEditar.planos && convenioParaEditar.planos.length > 0 ? convenioParaEditar.planos : [{ nome: '', descricao: '' }]);\n        } else {\n            // Reseta para o estado inicial ao criar um novo\n            setNome('');\n            setPlanos([{ nome: '', descricao: '' }]);\n        }\n    }, [convenioParaEditar, open]);\n\n    const handlePlanoChange = (index, event) => {\n        const newPlanos = [...planos];\n        newPlanos[index][event.target.name] = event.target.value;\n        setPlanos(newPlanos);\n    };\n\n    const handleAddPlano = () => {\n        setPlanos([...planos, { nome: '', descricao: '' }]);\n    };\n\n    const handleRemovePlano = (index) => {\n        if (planos.length > 1) {\n            setPlanos(planos.filter((_, i) => i !== index));\n        }\n    };\n\n    const handleSubmit = async (e) => {\n    e.preventDefault();\n    setIsSubmitting(true);\n\n    // Filtra planos que tenham um nome, para não enviar planos vazios\n    const planosValidos = planos.filter(p => p.nome.trim() !== '');\n\n    // --- A MUDANÇA ESTÁ AQUI ---\n    const convenioData = {\n        nome,\n        planos: planosValidos, // Envia a lista de planos junto\n    };\n\n    try {\n        if (convenioParaEditar) {\n            await apiClient.put(`/faturamento/convenios/${convenioParaEditar.id}/`, convenioData);\n        } else {\n            await apiClient.post('/faturamento/convenios/', convenioData);\n        }\n\n        showSnackbar('Convênio e planos salvos com sucesso!', 'success');\n        onSave();\n        onClose();\n    } catch (error) {\n        console.error(\"Erro ao salvar convênio:\", error.response?.data);\n        const errorMessage = error.response?.data?.nome?.[0] || 'Erro ao salvar convênio.';\n        showSnackbar(errorMessage, 'error');\n    } finally {\n        setIsSubmitting(false);\n    }\n};\n\n    return (\n        <Dialog open={open} onClose={onClose} fullWidth maxWidth=\"sm\">\n            <DialogTitle>{convenioParaEditar ? 'Editar Convênio' : 'Novo Convênio'}</DialogTitle>\n            <form onSubmit={handleSubmit}>\n                <DialogContent>\n                    <TextField autoFocus label=\"Nome do Convênio\" value={nome} onChange={(e) => setNome(e.target.value)} fullWidth required sx={{ mb: 3 }} />\n                    \n                    <Typography variant=\"subtitle1\" gutterBottom>Planos</Typography>\n                    {planos.map((plano, index) => (\n                        <Box key={index} sx={{ display: 'flex', gap: 1, alignItems: 'center', mb: 1.5 }}>\n                            <TextField name=\"nome\" label=\"Nome do Plano\" value={plano.nome} onChange={e => handlePlanoChange(index, e)} fullWidth size=\"small\" />\n                            <TextField name=\"descricao\" label=\"Descrição\" value={plano.descricao} onChange={e => handlePlanoChange(index, e)} fullWidth size=\"small\" />\n                            <IconButton onClick={() => handleRemovePlano(index)} color=\"error\" disabled={planos.length <= 1}>\n                                <RemoveCircleOutlineIcon />\n                            </IconButton>\n                        </Box>\n                    ))}\n                    <Button startIcon={<AddCircleOutlineIcon />} onClick={handleAddPlano} size=\"small\">\n                        Adicionar Plano\n                    </Button>\n                </DialogContent>\n                <DialogActions>\n                    <Button onClick={onClose}>Cancelar</Button>\n                    <Button type=\"submit\" variant=\"contained\" disabled={isSubmitting}>\n                        {isSubmitting ? <CircularProgress size={24} /> : 'Salvar'}\n                    </Button>\n                </DialogActions>\n            </form>\n        </Dialog>\n    );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}