{"ast":null,"code":"// src/components/prontuario/AnexosTab.jsx\nimport React,{useState,useEffect,useCallback}from'react';import{Box,Button,CircularProgress,TextField,Typography,Paper,List,ListItem,ListItemText,ListItemAvatar,Avatar,IconButton}from'@mui/material';import InsertDriveFileIcon from'@mui/icons-material/InsertDriveFile';import DownloadIcon from'@mui/icons-material/Download';import apiClient from'../../api/axiosConfig';import{useSnackbar}from'../../contexts/SnackbarContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function AnexosTab(_ref){let{pacienteId}=_ref;const{showSnackbar}=useSnackbar();const[documentos,setDocumentos]=useState([]);const[isLoading,setIsLoading]=useState(true);const[isUploading,setIsUploading]=useState(false);// --- CORREÇÃO: Adicionando 'titulo' ao estado do formulário ---\nconst[selectedFile,setSelectedFile]=useState(null);const[titulo,setTitulo]=useState('');const[descricao,setDescricao]=useState('');const fetchDocumentos=useCallback(async()=>{setIsLoading(true);try{const response=await apiClient.get(\"/prontuario/pacientes/\".concat(pacienteId,\"/documentos/\"));setDocumentos(response.data);}catch(error){console.error(\"Erro ao buscar documentos:\",error);showSnackbar('Erro ao carregar documentos.','error');}finally{setIsLoading(false);}},[pacienteId,showSnackbar]);useEffect(()=>{fetchDocumentos();},[fetchDocumentos]);const handleFileChange=event=>{setSelectedFile(event.target.files[0]);};const handleUpload=async e=>{e.preventDefault();if(!selectedFile){showSnackbar('Por favor, selecione um arquivo.','warning');return;}setIsUploading(true);const formData=new FormData();formData.append('arquivo',selectedFile);formData.append('titulo',titulo);// <-- ADICIONADO AO FORMDATA\nformData.append('descricao',descricao);try{await apiClient.post(\"/prontuario/pacientes/\".concat(pacienteId,\"/documentos/\"),formData,{headers:{'Content-Type':'multipart/form-data'}});showSnackbar('Documento enviado com sucesso!','success');setSelectedFile(null);setTitulo('');// <-- LIMPA O CAMPO APÓS O ENVIO\nsetDescricao('');fetchDocumentos();}catch(error){var _error$response;console.error(\"Erro ao enviar documento:\",(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data);showSnackbar('Erro ao enviar documento.','error');}finally{setIsUploading(false);}};if(isLoading)return/*#__PURE__*/_jsx(CircularProgress,{});return/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsxs(Paper,{component:\"form\",onSubmit:handleUpload,elevation:2,sx:{p:2,mb:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Anexar Novo Documento\"}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:2,mb:2},children:[/*#__PURE__*/_jsxs(Button,{variant:\"outlined\",component:\"label\",children:[\"Selecionar Arquivo\",/*#__PURE__*/_jsx(\"input\",{type:\"file\",hidden:true,onChange:handleFileChange})]}),selectedFile&&/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:selectedFile.name})]}),/*#__PURE__*/_jsx(TextField,{label:\"T\\xEDtulo do Arquivo\",value:titulo,onChange:e=>setTitulo(e.target.value),fullWidth:true,required:true,margin:\"normal\"}),/*#__PURE__*/_jsx(TextField,{label:\"Descri\\xE7\\xE3o do Arquivo\",value:descricao,onChange:e=>setDescricao(e.target.value),fullWidth:true,margin:\"normal\"}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"contained\",disabled:isUploading,sx:{mt:1},children:isUploading?/*#__PURE__*/_jsx(CircularProgress,{size:24}):'Enviar'})]}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Documentos Anexados\"}),/*#__PURE__*/_jsx(List,{component:Paper,children:documentos.length>0?documentos.map(doc=>/*#__PURE__*/_jsxs(ListItem,{secondaryAction:/*#__PURE__*/_jsx(IconButton,{edge:\"end\",href:doc.arquivo,target:\"_blank\",rel:\"noopener noreferrer\",children:/*#__PURE__*/_jsx(DownloadIcon,{})}),children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(InsertDriveFileIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:doc.descricao,secondary:\"Enviado por \".concat(doc.enviado_por_nome,\" em \").concat(new Date(doc.data_upload).toLocaleDateString('pt-BR'))})]},doc.id)):/*#__PURE__*/_jsx(ListItem,{children:/*#__PURE__*/_jsx(ListItemText,{primary:\"Nenhum documento anexado para este paciente.\"})})})]});}","map":{"version":3,"names":["React","useState","useEffect","useCallback","Box","Button","CircularProgress","TextField","Typography","Paper","List","ListItem","ListItemText","ListItemAvatar","Avatar","IconButton","InsertDriveFileIcon","DownloadIcon","apiClient","useSnackbar","jsx","_jsx","jsxs","_jsxs","AnexosTab","_ref","pacienteId","showSnackbar","documentos","setDocumentos","isLoading","setIsLoading","isUploading","setIsUploading","selectedFile","setSelectedFile","titulo","setTitulo","descricao","setDescricao","fetchDocumentos","response","get","concat","data","error","console","handleFileChange","event","target","files","handleUpload","e","preventDefault","formData","FormData","append","post","headers","_error$response","children","component","onSubmit","elevation","sx","p","mb","variant","gutterBottom","display","alignItems","gap","type","hidden","onChange","name","label","value","fullWidth","required","margin","disabled","mt","size","length","map","doc","secondaryAction","edge","href","arquivo","rel","primary","secondary","enviado_por_nome","Date","data_upload","toLocaleDateString","id"],"sources":["/Users/macmini/Documents/Sistema_Consultorio/frontend/src/components/prontuario/AnexosTab.jsx"],"sourcesContent":["// src/components/prontuario/AnexosTab.jsx\nimport React, { useState, useEffect, useCallback } from 'react';\nimport {\n    Box, Button, CircularProgress, TextField, Typography, Paper,\n    List, ListItem, ListItemText, ListItemAvatar, Avatar, IconButton\n} from '@mui/material';\nimport InsertDriveFileIcon from '@mui/icons-material/InsertDriveFile';\nimport DownloadIcon from '@mui/icons-material/Download';\nimport apiClient from '../../api/axiosConfig';\nimport { useSnackbar } from '../../contexts/SnackbarContext';\n\nexport default function AnexosTab({ pacienteId }) {\n    const { showSnackbar } = useSnackbar();\n    const [documentos, setDocumentos] = useState([]);\n    const [isLoading, setIsLoading] = useState(true);\n    const [isUploading, setIsUploading] = useState(false);\n\n    // --- CORREÇÃO: Adicionando 'titulo' ao estado do formulário ---\n    const [selectedFile, setSelectedFile] = useState(null);\n    const [titulo, setTitulo] = useState('');\n    const [descricao, setDescricao] = useState('');\n\n    const fetchDocumentos = useCallback(async () => {\n        setIsLoading(true);\n        try {\n            const response = await apiClient.get(`/prontuario/pacientes/${pacienteId}/documentos/`);\n            setDocumentos(response.data);\n        } catch (error) {\n            console.error(\"Erro ao buscar documentos:\", error);\n            showSnackbar('Erro ao carregar documentos.', 'error');\n        } finally {\n            setIsLoading(false);\n        }\n    }, [pacienteId, showSnackbar]);\n\n    useEffect(() => {\n        fetchDocumentos();\n    }, [fetchDocumentos]);\n\n    const handleFileChange = (event) => {\n        setSelectedFile(event.target.files[0]);\n    };\n\n    const handleUpload = async (e) => {\n        e.preventDefault();\n        if (!selectedFile) {\n            showSnackbar('Por favor, selecione um arquivo.', 'warning');\n            return;\n        }\n        setIsUploading(true);\n\n        const formData = new FormData();\n        formData.append('arquivo', selectedFile);\n        formData.append('titulo', titulo); // <-- ADICIONADO AO FORMDATA\n        formData.append('descricao', descricao);\n\n        try {\n            await apiClient.post(`/prontuario/pacientes/${pacienteId}/documentos/`, formData, {\n                headers: { 'Content-Type': 'multipart/form-data' },\n            });\n            showSnackbar('Documento enviado com sucesso!', 'success');\n            setSelectedFile(null);\n            setTitulo(''); // <-- LIMPA O CAMPO APÓS O ENVIO\n            setDescricao('');\n            fetchDocumentos();\n        } catch (error) {\n            console.error(\"Erro ao enviar documento:\", error.response?.data);\n            showSnackbar('Erro ao enviar documento.', 'error');\n        } finally {\n            setIsUploading(false);\n        }\n    };\n\n    if (isLoading) return <CircularProgress />;\n\n     return (\n        <Box>\n            <Paper component=\"form\" onSubmit={handleUpload} elevation={2} sx={{ p: 2, mb: 3 }}>\n                <Typography variant=\"h6\" gutterBottom>Anexar Novo Documento</Typography>\n                <Box sx={{ display: 'flex', alignItems: 'center', gap: 2, mb: 2 }}>\n                    <Button variant=\"outlined\" component=\"label\">\n                        Selecionar Arquivo\n                        <input type=\"file\" hidden onChange={handleFileChange} />\n                    </Button>\n                    {selectedFile && <Typography variant=\"body2\">{selectedFile.name}</Typography>}\n                </Box>\n                {/* --- CORREÇÃO: Adicionando o campo de Título ao formulário --- */}\n                <TextField\n                    label=\"Título do Arquivo\"\n                    value={titulo}\n                    onChange={(e) => setTitulo(e.target.value)}\n                    fullWidth\n                    required\n                    margin=\"normal\"\n                />\n                <TextField\n                    label=\"Descrição do Arquivo\"\n                    value={descricao}\n                    onChange={(e) => setDescricao(e.target.value)}\n                    fullWidth\n                    margin=\"normal\"\n                />\n                <Button type=\"submit\" variant=\"contained\" disabled={isUploading} sx={{mt: 1}}>\n                    {isUploading ? <CircularProgress size={24} /> : 'Enviar'}\n                </Button>\n            </Paper>\n\n            <Typography variant=\"h6\" gutterBottom>Documentos Anexados</Typography>\n            <List component={Paper}>\n                {documentos.length > 0 ? (\n                    documentos.map(doc => (\n                        <ListItem key={doc.id} secondaryAction={\n                            <IconButton edge=\"end\" href={doc.arquivo} target=\"_blank\" rel=\"noopener noreferrer\">\n                                <DownloadIcon />\n                            </IconButton>\n                        }>\n                            <ListItemAvatar>\n                                <Avatar><InsertDriveFileIcon /></Avatar>\n                            </ListItemAvatar>\n                            <ListItemText \n                                primary={doc.descricao} \n                                secondary={`Enviado por ${doc.enviado_por_nome} em ${new Date(doc.data_upload).toLocaleDateString('pt-BR')}`} \n                            />\n                        </ListItem>\n                    ))\n                ) : (\n                    <ListItem>\n                        <ListItemText primary=\"Nenhum documento anexado para este paciente.\" />\n                    </ListItem>\n                )}\n            </List>\n        </Box>\n    );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}