{"ast":null,"code":"// src/components/financeiro/ProcedimentosView.jsx\nimport React,{useState,useEffect,useCallback}from'react';import{Box,Paper,Typography,Table,TableBody,TableCell,TableContainer,TableHead,TableRow,CircularProgress,IconButton,Button}from'@mui/material';import EditIcon from'@mui/icons-material/Edit';import{useSnackbar}from'../../contexts/SnackbarContext';import{faturamentoService}from'../../services/faturamentoService';import ProcedimentoModal from'./ProcedimentoModal';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function ProcedimentosView(){const[procedimentos,setProcedimentos]=useState([]);const[isLoading,setIsLoading]=useState(true);const{showSnackbar}=useSnackbar();const[isUploading,setIsUploading]=useState(false);const[isModalOpen,setIsModalOpen]=useState(false);const[procedimentoSelecionado,setProcedimentoSelecionado]=useState(null);const fetchProcedimentos=useCallback(async()=>{setIsLoading(true);try{const response=await faturamentoService.getProcedimentos();setProcedimentos(response.data);}catch(error){showSnackbar('Erro ao carregar procedimentos.','error');}finally{setIsLoading(false);}},[showSnackbar]);useEffect(()=>{fetchProcedimentos();},[fetchProcedimentos]);const handleOpenModal=procedimento=>{setProcedimentoSelecionado(procedimento);setIsModalOpen(true);};if(isLoading)return/*#__PURE__*/_jsx(CircularProgress,{});const handleFileUpload=async event=>{const file=event.target.files[0];if(!file)return;setIsUploading(true);const formData=new FormData();formData.append('arquivo_tuss',file);try{// Nota: Precisaremos criar 'uploadTuss' em nosso faturamentoService\nconst response=await faturamentoService.uploadTuss(formData);showSnackbar(\"\".concat(response.data.criados,\" novos procedimentos criados, \").concat(response.data.atualizados,\" atualizados.\"),'success');fetchProcedimentos();// Recarrega a lista\n}catch(error){showSnackbar('Erro no upload do arquivo.','error');}finally{setIsUploading(false);}};return/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'center',mb:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Procedimentos e Tabela de Pre\\xE7os\"}),/*#__PURE__*/_jsxs(Button,{variant:\"contained\",component:\"label\",disabled:isUploading,children:[isUploading?/*#__PURE__*/_jsx(CircularProgress,{size:24}):'Upload Tabela TUSS',/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".csv\",hidden:true,onChange:handleFileUpload})]})]}),/*#__PURE__*/_jsx(TableContainer,{component:Paper,children:/*#__PURE__*/_jsxs(Table,{children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:\"C\\xF3digo TUSS\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Descri\\xE7\\xE3o\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Valor Particular (R$)\"}),/*#__PURE__*/_jsx(TableCell,{align:\"right\",children:\"A\\xE7\\xF5es\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:procedimentos.map(proc=>/*#__PURE__*/_jsxs(TableRow,{hover:true,children:[/*#__PURE__*/_jsx(TableCell,{children:proc.codigo_tuss}),/*#__PURE__*/_jsx(TableCell,{children:proc.descricao}),/*#__PURE__*/_jsx(TableCell,{children:proc.valor_particular}),/*#__PURE__*/_jsx(TableCell,{align:\"right\",children:/*#__PURE__*/_jsx(IconButton,{onClick:()=>handleOpenModal(proc),title:\"Editar Pre\\xE7os de Conv\\xEAnios\",children:/*#__PURE__*/_jsx(EditIcon,{})})})]},proc.id))})]})}),procedimentoSelecionado&&/*#__PURE__*/_jsx(ProcedimentoModal,{open:isModalOpen,onClose:()=>setIsModalOpen(false),onSave:fetchProcedimentos,procedimento:procedimentoSelecionado})]});}","map":{"version":3,"names":["React","useState","useEffect","useCallback","Box","Paper","Typography","Table","TableBody","TableCell","TableContainer","TableHead","TableRow","CircularProgress","IconButton","Button","EditIcon","useSnackbar","faturamentoService","ProcedimentoModal","jsx","_jsx","jsxs","_jsxs","ProcedimentosView","procedimentos","setProcedimentos","isLoading","setIsLoading","showSnackbar","isUploading","setIsUploading","isModalOpen","setIsModalOpen","procedimentoSelecionado","setProcedimentoSelecionado","fetchProcedimentos","response","getProcedimentos","data","error","handleOpenModal","procedimento","handleFileUpload","event","file","target","files","formData","FormData","append","uploadTuss","concat","criados","atualizados","children","sx","display","justifyContent","alignItems","mb","variant","component","disabled","size","type","accept","hidden","onChange","align","map","proc","hover","codigo_tuss","descricao","valor_particular","onClick","title","id","open","onClose","onSave"],"sources":["/Users/macmini/Documents/Sistema_Consultorio/frontend/src/components/financeiro/ProcedimentosView.jsx"],"sourcesContent":["// src/components/financeiro/ProcedimentosView.jsx\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { Box, Paper, Typography, Table, TableBody, TableCell, TableContainer, TableHead, TableRow, CircularProgress, IconButton, Button } from '@mui/material';\nimport EditIcon from '@mui/icons-material/Edit';\nimport { useSnackbar } from '../../contexts/SnackbarContext';\nimport { faturamentoService } from '../../services/faturamentoService';\nimport ProcedimentoModal from './ProcedimentoModal';\n\nexport default function ProcedimentosView() {\n    const [procedimentos, setProcedimentos] = useState([]);\n    const [isLoading, setIsLoading] = useState(true);\n    const { showSnackbar } = useSnackbar();\n    const [isUploading, setIsUploading] = useState(false);\n    const [isModalOpen, setIsModalOpen] = useState(false);\n    const [procedimentoSelecionado, setProcedimentoSelecionado] = useState(null);\n\n    const fetchProcedimentos = useCallback(async () => {\n        setIsLoading(true);\n        try {\n            const response = await faturamentoService.getProcedimentos();\n            setProcedimentos(response.data);\n        } catch (error) {\n            showSnackbar('Erro ao carregar procedimentos.', 'error');\n        } finally {\n            setIsLoading(false);\n        }\n    }, [showSnackbar]);\n\n    useEffect(() => {\n        fetchProcedimentos();\n    }, [fetchProcedimentos]);\n    \n    const handleOpenModal = (procedimento) => {\n        setProcedimentoSelecionado(procedimento);\n        setIsModalOpen(true);\n    };\n\n    if (isLoading) return <CircularProgress />;\n\n    const handleFileUpload = async (event) => {\n        const file = event.target.files[0];\n        if (!file) return;\n\n        setIsUploading(true);\n        const formData = new FormData();\n        formData.append('arquivo_tuss', file);\n\n        try {\n            // Nota: Precisaremos criar 'uploadTuss' em nosso faturamentoService\n            const response = await faturamentoService.uploadTuss(formData); \n            showSnackbar(`${response.data.criados} novos procedimentos criados, ${response.data.atualizados} atualizados.`, 'success');\n            fetchProcedimentos(); // Recarrega a lista\n        } catch (error) {\n            showSnackbar('Erro no upload do arquivo.', 'error');\n        } finally {\n            setIsUploading(false);\n        }\n    };\n\n    return (\n        <Box>\n            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>\n                <Typography variant=\"h6\">Procedimentos e Tabela de Preços</Typography>\n                <Button\n                    variant=\"contained\"\n                    component=\"label\"\n                    disabled={isUploading}\n                >\n                    {isUploading ? <CircularProgress size={24} /> : 'Upload Tabela TUSS'}\n                    <input type=\"file\" accept=\".csv\" hidden onChange={handleFileUpload} />\n                </Button>\n            </Box>\n            <TableContainer component={Paper}>\n                <Table>\n                    <TableHead>\n                        <TableRow>\n                            <TableCell>Código TUSS</TableCell>\n                            <TableCell>Descrição</TableCell>\n                            <TableCell>Valor Particular (R$)</TableCell>\n                            <TableCell align=\"right\">Ações</TableCell>\n                        </TableRow>\n                    </TableHead>\n                    <TableBody>\n                        {procedimentos.map((proc) => (\n                            <TableRow key={proc.id} hover>\n                                <TableCell>{proc.codigo_tuss}</TableCell>\n                                <TableCell>{proc.descricao}</TableCell>\n                                <TableCell>{proc.valor_particular}</TableCell>\n                                <TableCell align=\"right\">\n                                    <IconButton onClick={() => handleOpenModal(proc)} title=\"Editar Preços de Convênios\">\n                                        <EditIcon />\n                                    </IconButton>\n                                </TableCell>\n                            </TableRow>\n                        ))}\n                    </TableBody>\n                </Table>\n            </TableContainer>\n\n            {procedimentoSelecionado && (\n                <ProcedimentoModal\n                    open={isModalOpen}\n                    onClose={() => setIsModalOpen(false)}\n                    onSave={fetchProcedimentos}\n                    procedimento={procedimentoSelecionado}\n                />\n            )}\n        </Box>\n    );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}