{"ast":null,"code":"import _objectSpread from\"/Users/macmini/Documents/Sistema_Consultorio/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// src/components/prontuario/AtestadosTab.jsx\nimport React,{useState,useEffect,useCallback}from'react';import{Box,Button,CircularProgress,TextField,Typography,Paper,Accordion,AccordionSummary,AccordionDetails,Select,MenuItem,InputLabel,FormControl}from'@mui/material';import ExpandMoreIcon from'@mui/icons-material/ExpandMore';import PictureAsPdfIcon from'@mui/icons-material/PictureAsPdf';import apiClient from'../../api/axiosConfig';import{useSnackbar}from'../../contexts/SnackbarContext';// 1. IMPORTE O SNACKBAR\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const initialFormState={tipo_atestado:'',observacoes:''};export default function AtestadosTab(_ref){let{pacienteId}=_ref;const{showSnackbar}=useSnackbar();// 2. INICIALIZE O HOOK\nconst[atestados,setAtestados]=useState([]);const[formData,setFormData]=useState(initialFormState);const[isLoading,setIsLoading]=useState(true);const fetchAtestados=useCallback(async()=>{setIsLoading(true);try{const response=await apiClient.get(\"/prontuario/pacientes/\".concat(pacienteId,\"/atestados/\"));setAtestados(response.data);}catch(error){// MUDANÇA AQUI\nshowSnackbar('Erro ao buscar histórico de atestados.','error');console.error(\"Erro ao buscar atestados:\",error);}finally{setIsLoading(false);}},[pacienteId,showSnackbar]);useEffect(()=>{fetchAtestados();},[fetchAtestados]);const handleSave=async e=>{e.preventDefault();setIsLoading(true);try{await apiClient.post(\"/prontuario/pacientes/\".concat(pacienteId,\"/atestados/\"),formData);showSnackbar('Atestado salvo com sucesso!','success');// Feedback de sucesso\nsetFormData(initialFormState);fetchAtestados();}catch(error){var _error$response;// MUDANÇA AQUI\nshowSnackbar('Erro ao salvar atestado.','error');console.error(\"Erro ao salvar atestado:\",(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data);}finally{setIsLoading(false);}};const handleGerarPdf=atestadoId=>{// Constrói a URL completa usando a baseURL do apiClient\nconst pdfUrl=\"\".concat(apiClient.defaults.baseURL,\"/atestados/\").concat(atestadoId,\"/pdf/\");window.open(pdfUrl,'_blank');};if(isLoading&&atestados.length===0)return/*#__PURE__*/_jsx(CircularProgress,{});return/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsxs(Paper,{component:\"form\",onSubmit:handleSave,elevation:2,sx:{p:2,mb:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Emitir Novo Atestado\"}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',flexDirection:'column',gap:2},children:[/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,required:true,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"tipo-atestado-label\",children:\"Tipo de Atestado\"}),/*#__PURE__*/_jsxs(Select,{labelId:\"tipo-atestado-label\",value:formData.tipo_atestado,label:\"Tipo de Atestado\",onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{tipo_atestado:e.target.value})),children:[/*#__PURE__*/_jsx(MenuItem,{value:\"Comparecimento\",children:\"Atestado de Comparecimento\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"Afastamento\",children:\"Atestado de Afastamento\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"Aptidao\",children:\"Atestado de Aptid\\xE3o F\\xEDsica\"})]})]}),/*#__PURE__*/_jsx(TextField,{label:\"Observa\\xE7\\xF5es (Texto do atestado, CID, etc.)\",value:formData.observacoes,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{observacoes:e.target.value})),multiline:true,rows:5,required:true}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"contained\",disabled:isLoading,sx:{alignSelf:'flex-start'},children:\"Salvar Atestado\"})]})]}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Hist\\xF3rico de Atestados\"}),atestados.length>0?atestados.map(atestado=>/*#__PURE__*/_jsxs(Accordion,{children:[/*#__PURE__*/_jsxs(AccordionSummary,{expandIcon:/*#__PURE__*/_jsx(ExpandMoreIcon,{}),children:[/*#__PURE__*/_jsx(Typography,{sx:{flexShrink:0,fontWeight:'bold'},children:new Date(atestado.data_emissao).toLocaleDateString('pt-BR')}),/*#__PURE__*/_jsx(Typography,{sx:{ml:2,color:'text.secondary'},children:atestado.tipo_atestado_display})]}),/*#__PURE__*/_jsxs(AccordionDetails,{children:[/*#__PURE__*/_jsx(Typography,{paragraph:true,children:atestado.observacoes}),/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(PictureAsPdfIcon,{}),onClick:()=>handleGerarPdf(atestado.id),variant:\"outlined\",size:\"small\",children:\"Gerar PDF\"})]})]},atestado.id)):/*#__PURE__*/_jsx(Typography,{children:\"Nenhum atestado registrado para este paciente.\"})]});}","map":{"version":3,"names":["React","useState","useEffect","useCallback","Box","Button","CircularProgress","TextField","Typography","Paper","Accordion","AccordionSummary","AccordionDetails","Select","MenuItem","InputLabel","FormControl","ExpandMoreIcon","PictureAsPdfIcon","apiClient","useSnackbar","jsx","_jsx","jsxs","_jsxs","initialFormState","tipo_atestado","observacoes","AtestadosTab","_ref","pacienteId","showSnackbar","atestados","setAtestados","formData","setFormData","isLoading","setIsLoading","fetchAtestados","response","get","concat","data","error","console","handleSave","e","preventDefault","post","_error$response","handleGerarPdf","atestadoId","pdfUrl","defaults","baseURL","window","open","length","children","component","onSubmit","elevation","sx","p","mb","variant","gutterBottom","display","flexDirection","gap","fullWidth","required","id","labelId","value","label","onChange","_objectSpread","target","multiline","rows","type","disabled","alignSelf","map","atestado","expandIcon","flexShrink","fontWeight","Date","data_emissao","toLocaleDateString","ml","color","tipo_atestado_display","paragraph","startIcon","onClick","size"],"sources":["/Users/macmini/Documents/Sistema_Consultorio/frontend/src/components/prontuario/AtestadosTab.jsx"],"sourcesContent":["// src/components/prontuario/AtestadosTab.jsx\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { \n    Box, Button, CircularProgress, TextField, Typography, Paper, Accordion, \n    AccordionSummary, AccordionDetails, Select, MenuItem, InputLabel, FormControl \n} from '@mui/material';\nimport ExpandMoreIcon from '@mui/icons-material/ExpandMore';\nimport PictureAsPdfIcon from '@mui/icons-material/PictureAsPdf';\nimport apiClient from '../../api/axiosConfig';\nimport { useSnackbar } from '../../contexts/SnackbarContext'; // 1. IMPORTE O SNACKBAR\n\nconst initialFormState = { tipo_atestado: '', observacoes: '' };\n\nexport default function AtestadosTab({ pacienteId }) {\n  const { showSnackbar } = useSnackbar(); // 2. INICIALIZE O HOOK\n  const [atestados, setAtestados] = useState([]);\n  const [formData, setFormData] = useState(initialFormState);\n  const [isLoading, setIsLoading] = useState(true);\n\n  const fetchAtestados = useCallback(async () => {\n    setIsLoading(true);\n    try {\n      const response = await apiClient.get(`/prontuario/pacientes/${pacienteId}/atestados/`);\n      setAtestados(response.data);\n    } catch (error) {\n      // MUDANÇA AQUI\n      showSnackbar('Erro ao buscar histórico de atestados.', 'error');\n      console.error(\"Erro ao buscar atestados:\", error);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [pacienteId, showSnackbar]);\n\n  useEffect(() => {\n    fetchAtestados();\n  }, [fetchAtestados]);\n\n  const handleSave = async (e) => {\n    e.preventDefault();\n    setIsLoading(true);\n    try {\n      await apiClient.post(`/prontuario/pacientes/${pacienteId}/atestados/`, formData);\n      showSnackbar('Atestado salvo com sucesso!', 'success'); // Feedback de sucesso\n      setFormData(initialFormState);\n      fetchAtestados();\n    } catch (error) {\n      // MUDANÇA AQUI\n      showSnackbar('Erro ao salvar atestado.', 'error');\n      console.error(\"Erro ao salvar atestado:\", error.response?.data);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  \n  const handleGerarPdf = (atestadoId) => {\n    // Constrói a URL completa usando a baseURL do apiClient\n    const pdfUrl = `${apiClient.defaults.baseURL}/atestados/${atestadoId}/pdf/`;\n    window.open(pdfUrl, '_blank');\n  };\n\n  if (isLoading && atestados.length === 0) return <CircularProgress />;\n\n  return (\n    <Box>\n      {/* Formulário para Novo Atestado */}\n      <Paper component=\"form\" onSubmit={handleSave} elevation={2} sx={{ p: 2, mb: 3 }}>\n        <Typography variant=\"h6\" gutterBottom>Emitir Novo Atestado</Typography>\n        <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>\n          <FormControl fullWidth required>\n            <InputLabel id=\"tipo-atestado-label\">Tipo de Atestado</InputLabel>\n            <Select\n              labelId=\"tipo-atestado-label\"\n              value={formData.tipo_atestado}\n              label=\"Tipo de Atestado\"\n              onChange={(e) => setFormData({ ...formData, tipo_atestado: e.target.value })}\n            >\n              <MenuItem value=\"Comparecimento\">Atestado de Comparecimento</MenuItem>\n              <MenuItem value=\"Afastamento\">Atestado de Afastamento</MenuItem>\n              <MenuItem value=\"Aptidao\">Atestado de Aptidão Física</MenuItem>\n            </Select>\n          </FormControl>\n          <TextField \n            label=\"Observações (Texto do atestado, CID, etc.)\" \n            value={formData.observacoes} \n            onChange={(e) => setFormData({ ...formData, observacoes: e.target.value })} \n            multiline \n            rows={5} \n            required \n          />\n          <Button type=\"submit\" variant=\"contained\" disabled={isLoading} sx={{ alignSelf: 'flex-start' }}>Salvar Atestado</Button>\n        </Box>\n      </Paper>\n\n      {/* Lista de Atestados Anteriores */}\n      <Typography variant=\"h6\" gutterBottom>Histórico de Atestados</Typography>\n      {atestados.length > 0 ? (\n        atestados.map(atestado => (\n          <Accordion key={atestado.id}>\n            <AccordionSummary expandIcon={<ExpandMoreIcon />}>\n              <Typography sx={{ flexShrink: 0, fontWeight: 'bold' }}>\n                {new Date(atestado.data_emissao).toLocaleDateString('pt-BR')}\n              </Typography>\n              <Typography sx={{ ml: 2, color: 'text.secondary' }}>\n                {atestado.tipo_atestado_display}\n              </Typography>\n            </AccordionSummary>\n            <AccordionDetails>\n              <Typography paragraph>{atestado.observacoes}</Typography>\n              <Button \n                startIcon={<PictureAsPdfIcon />} \n                onClick={() => handleGerarPdf(atestado.id)}\n                variant=\"outlined\"\n                size=\"small\"\n              >\n                Gerar PDF\n              </Button>\n            </AccordionDetails>\n          </Accordion>\n        ))\n      ) : (\n        <Typography>Nenhum atestado registrado para este paciente.</Typography>\n      )}\n    </Box>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}