{"ast":null,"code":"// src/components/financeiro/ProcedimentoModal.jsx\nimport React,{useState,useEffect}from'react';import{Dialog,DialogTitle,DialogContent,DialogActions,TextField,Button,CircularProgress,Box,Typography,List,ListItem,ListItemText,IconButton,Select,MenuItem,FormControl,InputLabel,Divider}from'@mui/material';import DeleteIcon from'@mui/icons-material/Delete';import{useSnackbar}from'../../contexts/SnackbarContext';import{faturamentoService}from'../../services/faturamentoService';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function ProcedimentoModal(_ref){let{open,onClose,onSave,procedimento}=_ref;const{showSnackbar}=useSnackbar();const[formData,setFormData]=useState({codigo_tuss:'',descricao:'',valor_particular:''});const[valoresConvenio,setValoresConvenio]=useState([]);// Para o formulário de adicionar novo preço\nconst[planosDisponiveis,setPlanosDisponiveis]=useState([]);const[planoSelecionadoId,setPlanoSelecionadoId]=useState('');const[valorConvenio,setValorConvenio]=useState('');const[isSubmitting,setIsSubmitting]=useState(false);useEffect(()=>{if(procedimento){setFormData({codigo_tuss:procedimento.codigo_tuss,descricao:procedimento.descricao,valor_particular:procedimento.valor_particular});setValoresConvenio(procedimento.valores_convenio||[]);}// Busca a lista de planos para o dropdown\nfaturamentoService.getPlanosConvenio().then(response=>setPlanosDisponiveis(response.data)).catch(()=>showSnackbar('Erro ao carregar planos de convênio.','error'));},[procedimento,open,showSnackbar]);const handleAddPrecoConvenio=async()=>{if(!planoSelecionadoId||!valorConvenio){showSnackbar('Selecione um plano e informe um valor.','warning');return;}setIsSubmitting(true);try{const data={plano_convenio_id:planoSelecionadoId,valor:valorConvenio};const response=await faturamentoService.definirPrecoConvenio(procedimento.id,data);// Atualiza a lista de preços localmente com a resposta da API\nsetValoresConvenio(response.data.valores_convenio);showSnackbar('Preço do convênio salvo!','success');setPlanoSelecionadoId('');setValorConvenio('');onSave();// Recarrega a lista principal\n}catch(error){showSnackbar('Erro ao salvar preço do convênio.','error');}finally{setIsSubmitting(false);}};return/*#__PURE__*/_jsxs(Dialog,{open:open,onClose:onClose,fullWidth:true,maxWidth:\"md\",children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Editar Procedimento\"}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsxs(Box,{component:\"form\",sx:{display:'flex',flexDirection:'column',gap:2,pt:1},children:[/*#__PURE__*/_jsx(TextField,{label:\"C\\xF3digo TUSS\",value:formData.codigo_tuss,InputProps:{readOnly:true}}),/*#__PURE__*/_jsx(TextField,{label:\"Descri\\xE7\\xE3o\",value:formData.descricao,InputProps:{readOnly:true}}),/*#__PURE__*/_jsx(TextField,{label:\"Valor Particular (R$)\",value:formData.valor_particular,InputProps:{readOnly:true}})]}),/*#__PURE__*/_jsx(Divider,{sx:{my:3}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Tabela de Pre\\xE7os por Conv\\xEAnio\"}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',gap:2,mb:2,alignItems:'center'},children:[/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Plano de Conv\\xEAnio\"}),/*#__PURE__*/_jsx(Select,{value:planoSelecionadoId,label:\"Plano de Conv\\xEAnio\",onChange:e=>setPlanoSelecionadoId(e.target.value),children:planosDisponiveis.map(plano=>/*#__PURE__*/_jsx(MenuItem,{value:plano.id,children:plano.nome},plano.id))})]}),/*#__PURE__*/_jsx(TextField,{label:\"Valor (R$)\",value:valorConvenio,onChange:e=>setValorConvenio(e.target.value),sx:{minWidth:150}}),/*#__PURE__*/_jsx(Button,{onClick:handleAddPrecoConvenio,variant:\"contained\",disabled:isSubmitting,children:isSubmitting?/*#__PURE__*/_jsx(CircularProgress,{size:24}):'Adicionar'})]}),/*#__PURE__*/_jsxs(List,{children:[valoresConvenio.map(item=>/*#__PURE__*/_jsx(ListItem,{secondaryAction:/*#__PURE__*/_jsx(IconButton,{edge:\"end\",\"aria-label\":\"delete\",children:/*#__PURE__*/_jsx(DeleteIcon,{})}),children:/*#__PURE__*/_jsx(ListItemText,{primary:item.plano_convenio.nome,secondary:\"Valor: R$ \".concat(item.valor)})},item.id)),valoresConvenio.length===0&&/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:\"Nenhum pre\\xE7o de conv\\xEAnio definido.\"})]})]}),/*#__PURE__*/_jsx(DialogActions,{children:/*#__PURE__*/_jsx(Button,{onClick:onClose,children:\"Fechar\"})})]});}","map":{"version":3,"names":["React","useState","useEffect","Dialog","DialogTitle","DialogContent","DialogActions","TextField","Button","CircularProgress","Box","Typography","List","ListItem","ListItemText","IconButton","Select","MenuItem","FormControl","InputLabel","Divider","DeleteIcon","useSnackbar","faturamentoService","jsx","_jsx","jsxs","_jsxs","ProcedimentoModal","_ref","open","onClose","onSave","procedimento","showSnackbar","formData","setFormData","codigo_tuss","descricao","valor_particular","valoresConvenio","setValoresConvenio","planosDisponiveis","setPlanosDisponiveis","planoSelecionadoId","setPlanoSelecionadoId","valorConvenio","setValorConvenio","isSubmitting","setIsSubmitting","valores_convenio","getPlanosConvenio","then","response","data","catch","handleAddPrecoConvenio","plano_convenio_id","valor","definirPrecoConvenio","id","error","fullWidth","maxWidth","children","component","sx","display","flexDirection","gap","pt","label","value","InputProps","readOnly","my","variant","gutterBottom","mb","alignItems","onChange","e","target","map","plano","nome","minWidth","onClick","disabled","size","item","secondaryAction","edge","primary","plano_convenio","secondary","concat","length","color"],"sources":["/Users/macmini/Documents/Sistema_Consultorio/frontend/src/components/financeiro/ProcedimentoModal.jsx"],"sourcesContent":["// src/components/financeiro/ProcedimentoModal.jsx\nimport React, { useState, useEffect } from 'react';\nimport { \n    Dialog, DialogTitle, DialogContent, DialogActions, TextField, Button, \n    CircularProgress, Box, Typography, List, ListItem, ListItemText, \n    IconButton, Select, MenuItem, FormControl, InputLabel, Divider \n} from '@mui/material';\nimport DeleteIcon from '@mui/icons-material/Delete';\nimport { useSnackbar } from '../../contexts/SnackbarContext';\nimport { faturamentoService } from '../../services/faturamentoService';\n\nexport default function ProcedimentoModal({ open, onClose, onSave, procedimento }) {\n    const { showSnackbar } = useSnackbar();\n    const [formData, setFormData] = useState({ codigo_tuss: '', descricao: '', valor_particular: '' });\n    const [valoresConvenio, setValoresConvenio] = useState([]);\n    \n    // Para o formulário de adicionar novo preço\n    const [planosDisponiveis, setPlanosDisponiveis] = useState([]);\n    const [planoSelecionadoId, setPlanoSelecionadoId] = useState('');\n    const [valorConvenio, setValorConvenio] = useState('');\n\n    const [isSubmitting, setIsSubmitting] = useState(false);\n\n    useEffect(() => {\n        if (procedimento) {\n            setFormData({\n                codigo_tuss: procedimento.codigo_tuss,\n                descricao: procedimento.descricao,\n                valor_particular: procedimento.valor_particular,\n            });\n            setValoresConvenio(procedimento.valores_convenio || []);\n        }\n\n        // Busca a lista de planos para o dropdown\n        faturamentoService.getPlanosConvenio()\n            .then(response => setPlanosDisponiveis(response.data))\n            .catch(() => showSnackbar('Erro ao carregar planos de convênio.', 'error'));\n            \n    }, [procedimento, open, showSnackbar]);\n\n    const handleAddPrecoConvenio = async () => {\n        if (!planoSelecionadoId || !valorConvenio) {\n            showSnackbar('Selecione um plano e informe um valor.', 'warning');\n            return;\n        }\n        setIsSubmitting(true);\n        try {\n            const data = { plano_convenio_id: planoSelecionadoId, valor: valorConvenio };\n            const response = await faturamentoService.definirPrecoConvenio(procedimento.id, data);\n            \n            // Atualiza a lista de preços localmente com a resposta da API\n            setValoresConvenio(response.data.valores_convenio);\n            showSnackbar('Preço do convênio salvo!', 'success');\n            setPlanoSelecionadoId('');\n            setValorConvenio('');\n            onSave(); // Recarrega a lista principal\n        } catch (error) {\n            showSnackbar('Erro ao salvar preço do convênio.', 'error');\n        } finally {\n            setIsSubmitting(false);\n        }\n    };\n\n    return (\n        <Dialog open={open} onClose={onClose} fullWidth maxWidth=\"md\">\n            <DialogTitle>Editar Procedimento</DialogTitle>\n            <DialogContent>\n                {/* Seção de Dados Principais */}\n                <Box component=\"form\" sx={{ display: 'flex', flexDirection: 'column', gap: 2, pt: 1 }}>\n                    <TextField label=\"Código TUSS\" value={formData.codigo_tuss} InputProps={{ readOnly: true }} />\n                    <TextField label=\"Descrição\" value={formData.descricao} InputProps={{ readOnly: true }} />\n                    <TextField label=\"Valor Particular (R$)\" value={formData.valor_particular} InputProps={{ readOnly: true }} />\n                </Box>\n                \n                <Divider sx={{ my: 3 }} />\n\n                {/* Seção da Tabela de Preços */}\n                <Typography variant=\"h6\" gutterBottom>Tabela de Preços por Convênio</Typography>\n                \n                {/* Formulário para adicionar novo preço */}\n                <Box sx={{ display: 'flex', gap: 2, mb: 2, alignItems: 'center' }}>\n                    <FormControl fullWidth>\n                        <InputLabel>Plano de Convênio</InputLabel>\n                        <Select\n                            value={planoSelecionadoId}\n                            label=\"Plano de Convênio\"\n                            onChange={(e) => setPlanoSelecionadoId(e.target.value)}\n                        >\n                            {planosDisponiveis.map(plano => (\n                                <MenuItem key={plano.id} value={plano.id}>{plano.nome}</MenuItem>\n                            ))}\n                        </Select>\n                    </FormControl>\n                    <TextField\n                        label=\"Valor (R$)\"\n                        value={valorConvenio}\n                        onChange={(e) => setValorConvenio(e.target.value)}\n                        sx={{ minWidth: 150 }}\n                    />\n                    <Button onClick={handleAddPrecoConvenio} variant=\"contained\" disabled={isSubmitting}>\n                        {isSubmitting ? <CircularProgress size={24} /> : 'Adicionar'}\n                    </Button>\n                </Box>\n\n                {/* Lista de preços já definidos */}\n                <List>\n                    {valoresConvenio.map(item => (\n                        <ListItem key={item.id} secondaryAction={<IconButton edge=\"end\" aria-label=\"delete\"><DeleteIcon /></IconButton>}>\n                            <ListItemText primary={item.plano_convenio.nome} secondary={`Valor: R$ ${item.valor}`} />\n                        </ListItem>\n                    ))}\n                     {valoresConvenio.length === 0 && <Typography variant=\"body2\" color=\"text.secondary\">Nenhum preço de convênio definido.</Typography>}\n                </List>\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={onClose}>Fechar</Button>\n            </DialogActions>\n        </Dialog>\n    );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}