{"ast":null,"code":"import _objectSpread from\"/Users/macmini/Documents/Sistema_Consultorio/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// src/components/financeiro/DespesasView.jsx\nimport React,{useState,useEffect,useCallback}from'react';import{Box,Button,CircularProgress,TextField,Paper,Table,TableBody,TableCell,TableContainer,TableHead,TableRow,Select,MenuItem,InputLabel,FormControl}from'@mui/material';import{faturamentoService}from'../../services/faturamentoService';// <-- ADICIONADO\nimport{useSnackbar}from'../../contexts/SnackbarContext';// <-- IMPORTE O HOOK DE NOTIFICAÇÃO\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const initialFormState={descricao:'',valor:'',categoria:'',data_despesa:new Date().toISOString().split('T')[0]};export default function DespesasView(){const{showSnackbar}=useSnackbar();// <-- USE O HOOK\nconst[despesas,setDespesas]=useState([]);const[categorias,setCategorias]=useState([]);const[formData,setFormData]=useState(initialFormState);const[isLoading,setIsLoading]=useState(false);const[isSubmitting,setIsSubmitting]=useState(false);const fetchData=async()=>{try{// AQUI ESTÁ A MUDANÇA: Usando o serviço\nconst[despesasRes,categoriasRes]=await Promise.all([faturamentoService.getDespesas(),faturamentoService.getCategoriasDespesa()]);setDespesas(despesasRes.data);setCategorias(categoriasRes.data);}catch(error){console.error(\"Erro ao buscar dados financeiros:\",error);showSnackbar('Erro ao carregar dados.','error');}finally{setIsLoading(false);}};useEffect(()=>{setIsLoading(true);fetchData();},[]);const handleSave=async e=>{e.preventDefault();setIsSubmitting(true);try{// AQUI ESTÁ A MUDANÇA: Usando o serviço\nawait faturamentoService.createDespesa(formData);showSnackbar('Despesa salva com sucesso!','success');setFormData(initialFormState);fetchData();}catch(error){var _error$response;console.error(\"Erro ao salvar despesa:\",(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data);showSnackbar('Erro ao salvar despesa. Verifique os campos.','error');}finally{setIsSubmitting(false);}};if(isLoading&&despesas.length===0)return/*#__PURE__*/_jsx(CircularProgress,{});return/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsxs(Paper,{component:\"form\",onSubmit:handleSave,elevation:2,sx:{p:2,mb:3,display:'flex',gap:2,alignItems:'flex-start'},children:[/*#__PURE__*/_jsx(TextField,{name:\"descricao\",label:\"Descri\\xE7\\xE3o\",value:formData.descricao,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{descricao:e.target.value})),required:true,fullWidth:true}),/*#__PURE__*/_jsx(TextField,{name:\"data_despesa\",label:\"Data da Despesa\",type:\"date\",value:formData.data_despesa,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{data_despesa:e.target.value})),InputLabelProps:{shrink:true},required:true}),/*#__PURE__*/_jsx(TextField,{name:\"valor\",label:\"Valor (R$)\",type:\"number\",value:formData.valor,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{valor:e.target.value})),required:true}),/*#__PURE__*/_jsxs(FormControl,{required:true,sx:{minWidth:200},children:[/*#__PURE__*/_jsx(InputLabel,{id:\"categoria-select-label\",children:\"Categoria\"}),/*#__PURE__*/_jsx(Select,{labelId:\"categoria-select-label\",name:\"categoria\",value:formData.categoria,label:\"Categoria\",onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{categoria:e.target.value})),children:categorias.map(cat=>/*#__PURE__*/_jsx(MenuItem,{value:cat.id,children:cat.nome},cat.id))})]}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"contained\",disabled:isLoading,sx:{height:56},children:\"Adicionar\"})]}),/*#__PURE__*/_jsx(TableContainer,{component:Paper,children:/*#__PURE__*/_jsxs(Table,{children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:\"Data da Despesa\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Descri\\xE7\\xE3o\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Categoria\"}),/*#__PURE__*/_jsx(TableCell,{align:\"right\",children:\"Valor (R$)\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:despesas.map(despesa=>/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:new Date(despesa.data_despesa).toLocaleDateString('pt-BR',{timeZone:'UTC'})}),/*#__PURE__*/_jsx(TableCell,{children:despesa.descricao}),/*#__PURE__*/_jsx(TableCell,{children:despesa.categoria_nome}),/*#__PURE__*/_jsx(TableCell,{align:\"right\",children:parseFloat(despesa.valor).toFixed(2)})]},despesa.id))})]})})]});}","map":{"version":3,"names":["React","useState","useEffect","useCallback","Box","Button","CircularProgress","TextField","Paper","Table","TableBody","TableCell","TableContainer","TableHead","TableRow","Select","MenuItem","InputLabel","FormControl","faturamentoService","useSnackbar","jsx","_jsx","jsxs","_jsxs","initialFormState","descricao","valor","categoria","data_despesa","Date","toISOString","split","DespesasView","showSnackbar","despesas","setDespesas","categorias","setCategorias","formData","setFormData","isLoading","setIsLoading","isSubmitting","setIsSubmitting","fetchData","despesasRes","categoriasRes","Promise","all","getDespesas","getCategoriasDespesa","data","error","console","handleSave","e","preventDefault","createDespesa","_error$response","response","length","children","component","onSubmit","elevation","sx","p","mb","display","gap","alignItems","name","label","value","onChange","_objectSpread","target","required","fullWidth","type","InputLabelProps","shrink","minWidth","id","labelId","map","cat","nome","variant","disabled","height","align","despesa","toLocaleDateString","timeZone","categoria_nome","parseFloat","toFixed"],"sources":["/Users/macmini/Documents/Sistema_Consultorio/frontend/src/components/financeiro/DespesasView.jsx"],"sourcesContent":["// src/components/financeiro/DespesasView.jsx\nimport React, { useState, useEffect, useCallback } from 'react';\nimport {\n    Box, Button, CircularProgress, TextField, Paper,\n    Table, TableBody, TableCell, TableContainer, TableHead, TableRow,\n    Select, MenuItem, InputLabel, FormControl\n} from '@mui/material';\n\nimport { faturamentoService } from '../../services/faturamentoService'; // <-- ADICIONADO\nimport { useSnackbar } from '../../contexts/SnackbarContext'; // <-- IMPORTE O HOOK DE NOTIFICAÇÃO\n\nconst initialFormState = { \n    descricao: '', \n    valor: '', \n    categoria: '', \n    data_despesa: new Date().toISOString().split('T')[0]\n};\n\nexport default function DespesasView() {\n    const { showSnackbar } = useSnackbar(); // <-- USE O HOOK\n    const [despesas, setDespesas] = useState([]);\n    const [categorias, setCategorias] = useState([]);\n    const [formData, setFormData] = useState(initialFormState);\n    const [isLoading, setIsLoading] = useState(false);\n    const [isSubmitting, setIsSubmitting] = useState(false);\n\n    const fetchData = async () => {\n        try {\n            // AQUI ESTÁ A MUDANÇA: Usando o serviço\n            const [despesasRes, categoriasRes] = await Promise.all([\n                faturamentoService.getDespesas(),\n                faturamentoService.getCategoriasDespesa()\n            ]);\n            setDespesas(despesasRes.data);\n            setCategorias(categoriasRes.data);\n        } catch (error) {\n            console.error(\"Erro ao buscar dados financeiros:\", error);\n            showSnackbar('Erro ao carregar dados.', 'error');\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    useEffect(() => {\n        setIsLoading(true);\n        fetchData();\n    }, []);\n\n    const handleSave = async (e) => {\n        e.preventDefault();\n        setIsSubmitting(true);\n        try {\n            // AQUI ESTÁ A MUDANÇA: Usando o serviço\n            await faturamentoService.createDespesa(formData);\n            showSnackbar('Despesa salva com sucesso!', 'success');\n            setFormData(initialFormState);\n            fetchData();\n        } catch (error) {\n            console.error(\"Erro ao salvar despesa:\", error.response?.data);\n            showSnackbar('Erro ao salvar despesa. Verifique os campos.', 'error');\n        } finally {\n            setIsSubmitting(false);\n        }\n    };\n\n    if (isLoading && despesas.length === 0) return <CircularProgress />;\n\n    return (\n        <Box>\n            <Paper component=\"form\" onSubmit={handleSave} elevation={2} sx={{ p: 2, mb: 3, display: 'flex', gap: 2, alignItems: 'flex-start' }}>\n                <TextField name=\"descricao\" label=\"Descrição\" value={formData.descricao} onChange={(e) => setFormData({ ...formData, descricao: e.target.value })} required fullWidth />\n                \n                {/* --- 2. ADICIONADO INPUT DE DATA --- */}\n                <TextField\n                    name=\"data_despesa\"\n                    label=\"Data da Despesa\"\n                    type=\"date\"\n                    value={formData.data_despesa}\n                    onChange={(e) => setFormData({ ...formData, data_despesa: e.target.value })}\n                    InputLabelProps={{ shrink: true }}\n                    required\n                />\n\n                <TextField name=\"valor\" label=\"Valor (R$)\" type=\"number\" value={formData.valor} onChange={(e) => setFormData({ ...formData, valor: e.target.value })} required />\n                \n                <FormControl required sx={{ minWidth: 200 }}>\n                    <InputLabel id=\"categoria-select-label\">Categoria</InputLabel>\n                    <Select\n                        labelId=\"categoria-select-label\"\n                        name=\"categoria\"\n                        value={formData.categoria}\n                        label=\"Categoria\"\n                        onChange={(e) => setFormData({ ...formData, categoria: e.target.value })}\n                    >\n                        {categorias.map((cat) => (\n                            <MenuItem key={cat.id} value={cat.id}>{cat.nome}</MenuItem>\n                        ))}\n                    </Select>\n                </FormControl>\n                \n                <Button type=\"submit\" variant=\"contained\" disabled={isLoading} sx={{ height: 56 }}>Adicionar</Button>\n            </Paper>\n\n            <TableContainer component={Paper}>\n                <Table>\n                    <TableHead>\n                        <TableRow>\n                            <TableCell>Data da Despesa</TableCell>\n                            <TableCell>Descrição</TableCell>\n                            <TableCell>Categoria</TableCell>\n                            <TableCell align=\"right\">Valor (R$)</TableCell>\n                        </TableRow>\n                    </TableHead>\n                    <TableBody>\n                        {despesas.map((despesa) => (\n                            <TableRow key={despesa.id}>\n                                <TableCell>{new Date(despesa.data_despesa).toLocaleDateString('pt-BR', { timeZone: 'UTC' })}</TableCell>\n                                <TableCell>{despesa.descricao}</TableCell>\n                                <TableCell>{despesa.categoria_nome}</TableCell>\n                                <TableCell align=\"right\">{parseFloat(despesa.valor).toFixed(2)}</TableCell>\n                            </TableRow>\n                        ))}\n                    </TableBody>\n                </Table>\n            </TableContainer>\n        </Box>\n    );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}